/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Vista;

import Controlador.Coordinador;
import javax.swing.JOptionPane;
import javax.swing.UIManager;

/**
 *
 * @author Navarro
 */
public class frmLoginRecuperacion extends javax.swing.JFrame {

    private int x;
    private int y;
    private String ampm;
    private String minutos;
    private String segundos;
    private String usuario;
    private Coordinador coordinador;

    public frmLoginRecuperacion() {
        this.setlook();
        initComponents();
        setLocationRelativeTo(null);
    }

    public void setlook() {
        try {
            UIManager.setLookAndFeel("com.sun.java.swing.plaf.windows.WindowsLookAndFeel");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }


    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel3 = new javax.swing.JPanel();
        lblTitulo = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        lblTitulo21 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        txtUsuario = new javax.swing.JTextField();
        lblTitulo22 = new javax.swing.JLabel();
        txtClave = new javax.swing.JPasswordField();
        jLabel2 = new javax.swing.JLabel();
        lblTitulo19 = new javax.swing.JLabel();
        txtClave2 = new javax.swing.JPasswordField();
        jLabel4 = new javax.swing.JLabel();
        btnIngresar = new javax.swing.JButton();
        btnSalir = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setUndecorated(true);
        setResizable(false);
        addWindowFocusListener(new java.awt.event.WindowFocusListener() {
            public void windowGainedFocus(java.awt.event.WindowEvent evt) {
            }
            public void windowLostFocus(java.awt.event.WindowEvent evt) {
                formWindowLostFocus(evt);
            }
        });
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jPanel3.setBackground(new java.awt.Color(69, 90, 100));
        jPanel3.addMouseMotionListener(new java.awt.event.MouseMotionAdapter() {
            public void mouseDragged(java.awt.event.MouseEvent evt) {
                jPanel3MouseDragged(evt);
            }
        });
        jPanel3.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mousePressed(java.awt.event.MouseEvent evt) {
                jPanel3MousePressed(evt);
            }
        });
        jPanel3.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lblTitulo.setBackground(new java.awt.Color(2, 119, 189));
        lblTitulo.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        lblTitulo.setForeground(new java.awt.Color(255, 255, 255));
        lblTitulo.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lblTitulo.setText("Recuperaci√≥n de Clave");
        lblTitulo.setOpaque(true);
        jPanel3.add(lblTitulo, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 250, 30));

        jPanel1.setBackground(new java.awt.Color(2, 119, 189));
        jPanel1.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lblTitulo21.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lblTitulo21.setForeground(new java.awt.Color(255, 255, 255));
        lblTitulo21.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lblTitulo21.setText("Usuario");
        jPanel1.add(lblTitulo21, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 10, 140, 30));

        jLabel3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Recursos/user24.png"))); // NOI18N
        jPanel1.add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 40, 30, 30));

        txtUsuario.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        txtUsuario.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        txtUsuario.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtUsuarioKeyTyped(evt);
            }
        });
        jPanel1.add(txtUsuario, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 40, 140, 30));

        lblTitulo22.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lblTitulo22.setForeground(new java.awt.Color(255, 255, 255));
        lblTitulo22.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lblTitulo22.setText("Nueva Clave");
        jPanel1.add(lblTitulo22, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 70, 140, 30));

        txtClave.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        txtClave.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        txtClave.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtClaveActionPerformed(evt);
            }
        });
        txtClave.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtClaveKeyTyped(evt);
            }
        });
        jPanel1.add(txtClave, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 100, 140, 30));

        jLabel2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Recursos/icon_clave.png"))); // NOI18N
        jPanel1.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 100, 40, 30));

        lblTitulo19.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lblTitulo19.setForeground(new java.awt.Color(255, 255, 255));
        lblTitulo19.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lblTitulo19.setText("Repita Clave");
        jPanel1.add(lblTitulo19, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 130, 140, 30));

        txtClave2.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        txtClave2.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        txtClave2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtClave2ActionPerformed(evt);
            }
        });
        txtClave2.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtClave2KeyTyped(evt);
            }
        });
        jPanel1.add(txtClave2, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 160, 140, 30));

        jLabel4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Recursos/icon_clave.png"))); // NOI18N
        jPanel1.add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 160, 40, 30));

        btnIngresar.setFont(new java.awt.Font("Arial", 1, 11)); // NOI18N
        btnIngresar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Recursos/icon_update16.png"))); // NOI18N
        btnIngresar.setText("Actualizar");
        btnIngresar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnIngresarActionPerformed(evt);
            }
        });
        jPanel1.add(btnIngresar, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 210, 110, -1));

        btnSalir.setFont(new java.awt.Font("Arial", 1, 11)); // NOI18N
        btnSalir.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Recursos/icon_exit16.png"))); // NOI18N
        btnSalir.setText("Salir");
        btnSalir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSalirActionPerformed(evt);
            }
        });
        jPanel1.add(btnSalir, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 210, 90, -1));

        jPanel3.add(jPanel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 40, 230, 250));

        getContentPane().add(jPanel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 250, 300));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jPanel3MousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jPanel3MousePressed

    }//GEN-LAST:event_jPanel3MousePressed

    private void jPanel3MouseDragged(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jPanel3MouseDragged

    }//GEN-LAST:event_jPanel3MouseDragged

    private void btnIngresarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnIngresarActionPerformed
        VO.UsuarioVO datosUsuario = datosUsuario = coordinador.consultarUsuario(txtUsuario.getText());
           String clave1 = coordinador.getClave(txtClave.getPassword());
           String clave2 = coordinador.getClave(txtClave2.getPassword());
        if (datosUsuario.getPregunta_secreta()!=null) {
        if (!clave1.isEmpty() || !clave2.isEmpty()) {
            if (clave1.equals(clave2)) {
            String pregunta = datosUsuario.getPregunta_secreta();
            String respuesta = datosUsuario.getRespuesta_secreta();
            String res ="";
            boolean entrada;
            do {
                entrada = true;
                if (entrada) {
                    res = JOptionPane.showInputDialog(null, pregunta, "Pregunta de seguridad", JOptionPane.QUESTION_MESSAGE);
                    if (res.equals(respuesta)) {
                        entrada = true;
                        //actualizo la clave
                      JOptionPane.showMessageDialog(null,  coordinador.actualizarClaveUsuario(clave1, String.valueOf(datosUsuario.getId_usuario())) , "Informacion", JOptionPane.PLAIN_MESSAGE); 
                      borrarCampos();
                    }else{
                        entrada = false;
                    }
                }
            } while (!entrada);
            } else {
                JOptionPane.showMessageDialog(null, "Claves no Coinciden", "Informacion", JOptionPane.PLAIN_MESSAGE);
            }
        } else {
            JOptionPane.showMessageDialog(null, "Campos Vacios", "Informacion", JOptionPane.PLAIN_MESSAGE);
        }
        }else{
            JOptionPane.showMessageDialog(null, "Usuario no existe", "Informacion", JOptionPane.PLAIN_MESSAGE);
        }
    }//GEN-LAST:event_btnIngresarActionPerformed

    private void btnSalirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSalirActionPerformed
        this.dispose();
    }//GEN-LAST:event_btnSalirActionPerformed

    private void txtClave2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtClave2ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtClave2ActionPerformed

    private void formWindowLostFocus(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowLostFocus
    this.requestFocus();
    }//GEN-LAST:event_formWindowLostFocus

    private void txtClaveKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtClaveKeyTyped
char c = evt.getKeyChar();
char[] arrayC1 = txtClave.getPassword(); 
    String c1 = new String(arrayC1);
        int lim = c1.length();
            //establesco limite
            //cambie este numero que es el limite
            if (lim >= 15) {
                evt.consume();
                getToolkit().beep();
            }        // TODO add your handling code here:
    }//GEN-LAST:event_txtClaveKeyTyped

    private void txtClave2KeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtClave2KeyTyped
char c = evt.getKeyChar();
char[] arrayC1 = txtClave2.getPassword(); 
    String c1 = new String(arrayC1);
        int lim = c1.length();
            //establesco limite
            //cambie este numero que es el limite
            if (lim >= 15) {
                evt.consume();
                getToolkit().beep();
            }           // TODO add your handling code here:
    }//GEN-LAST:event_txtClave2KeyTyped

    private void txtUsuarioKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtUsuarioKeyTyped
char c = evt.getKeyChar();
        int lim = txtUsuario.getText().length();
            //establesco limite
            //cambie este numero que es el limite
            if (lim >= 10) {
                evt.consume();
                getToolkit().beep();
            }           // TODO add your handling code here:
    }//GEN-LAST:event_txtUsuarioKeyTyped

    private void txtClaveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtClaveActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtClaveActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new frmLoginRecuperacion().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnIngresar;
    private javax.swing.JButton btnSalir;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JLabel lblTitulo;
    private javax.swing.JLabel lblTitulo19;
    private javax.swing.JLabel lblTitulo21;
    private javax.swing.JLabel lblTitulo22;
    private javax.swing.JPasswordField txtClave;
    private javax.swing.JPasswordField txtClave2;
    private javax.swing.JTextField txtUsuario;
    // End of variables declaration//GEN-END:variables

    public void setCoordinador(Coordinador coordinador) {
       this.coordinador = coordinador;
    }

    private void borrarCampos() {
        txtUsuario.setText("");
        txtClave2.setText("");
        txtClave.setText("");
    }
}
